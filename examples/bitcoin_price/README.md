# Bitcoin Price Prediction Tutorial

This tutorial demonstrates how to use AIDE ML to build a time series forecasting model for Bitcoin prices using both Claude Code and Anthropic backends.

## üîß Import Note

When creating your own scripts that use AIDE ML, always import from the `aideml.aide` package after adding the parent of aideml to the Python path:

```python
# Add parent of aideml to path
import sys
from pathlib import Path
aideml_parent = Path(__file__).parent.parent.parent  # Adjust based on your script location
sys.path.insert(0, str(aideml_parent))

# Then import from aideml.aide package
from aideml.aide.run import run_experiment
from aideml.aide.backend import query_with_backend
from aideml.aide.utils.config import load_config
```

The `run_bitcoin.py` script demonstrates this pattern correctly.

## üìã Task Overview

**Goal**: Build a time series forecasting model for Bitcoin close price  
**Evaluation Metric**: Root-Mean-Squared-Error (RMSE) between the logarithm of predicted and observed prices  
**Data**: Historical BTC-USD price data from `aide/example_tasks/bitcoin_price/BTC-USD.csv`

## üöÄ Quick Start

### 1. Using Claude Code Backend

```bash
# Basic run
python run_bitcoin.py --backend claude_code

# With specific model
python run_bitcoin.py --backend claude_code --model claude-opus-4

# With MCP enabled for enhanced function calling
python run_bitcoin.py --backend claude_code --use-mcp

# With custom timeout and workers
python run_bitcoin.py --backend claude_code --timeout 600 --workers 2
```

### 2. Using Anthropic Backend

```bash
# Basic run
python run_bitcoin.py --backend anthropic

# With specific model
python run_bitcoin.py --backend anthropic --model claude-3-5-sonnet-20241022

# With custom parameters
python run_bitcoin.py --backend anthropic --timeout 300 --iterations 5
```

### 3. Compare Both Backends

```bash
# Run comparison
python run_bitcoin.py --compare

# This will run the task with both backends and show a comparison
```

## üìä Understanding the Task

The Bitcoin price prediction task challenges AIDE ML to:

1. **Load and explore** the historical Bitcoin price data
2. **Perform time series analysis** to understand patterns and trends
3. **Engineer features** appropriate for time series forecasting
4. **Build models** using various approaches (ARIMA, Prophet, ML models, etc.)
5. **Evaluate performance** using RMSE on log-transformed prices

### Data Structure

The BTC-USD.csv file contains:
- Date: Trading date
- Open: Opening price
- High: Highest price of the day
- Low: Lowest price of the day
- Close: Closing price (target variable)
- Volume: Trading volume
- Adj Close: Adjusted closing price

## üîß Script Options

The `run_bitcoin.py` script supports various options:

```
Options:
  --backend           Backend to use (claude_code, anthropic)
  --model            Model name (e.g., claude-opus-4, claude-3-5-sonnet)
  --use-mcp          Enable MCP for Claude Code backend
  --timeout          Request timeout in seconds (default: 300)
  --workers          Number of parallel workers (default: 4)
  --iterations       Number of iterations (default: 10)
  --compare          Run with both backends and compare
  --output-dir       Directory for outputs (default: outputs/)
  --debug            Enable debug logging
```

## üìà Expected Outputs

After running, you'll find:

1. **Solution Code**: `outputs/bitcoin_price_<backend>_<timestamp>/solution.py`
   - The best performing model code generated by AIDE ML

2. **Journal Log**: `outputs/bitcoin_price_<backend>_<timestamp>/journal.json`
   - Complete log of AIDE ML's reasoning and iterations

3. **Performance Report**: `outputs/bitcoin_price_<backend>_<timestamp>/report.md`
   - Human-readable report of the process and results

4. **Tree Visualization**: `outputs/bitcoin_price_<backend>_<timestamp>/tree.html`
   - Interactive visualization of the solution search tree

## üéØ Typical Solutions

AIDE ML typically explores various approaches for this task:

1. **Statistical Models**:
   - ARIMA/SARIMA models
   - Exponential smoothing
   - Prophet for trend and seasonality

2. **Machine Learning Models**:
   - Random Forest with lag features
   - XGBoost with time-based features
   - Neural networks (LSTM/GRU)

3. **Feature Engineering**:
   - Technical indicators (moving averages, RSI)
   - Lag features and rolling statistics
   - Time-based features (day of week, month)

## üìä Performance Expectations

Typical performance metrics:
- **RMSE (log scale)**: 0.02 - 0.05 for good models
- **Execution time**: 2-5 minutes per iteration
- **Total time**: 20-50 minutes for full run

### Backend Comparison

| Aspect | Claude Code | Anthropic |
|--------|-------------|-----------|
| Code Quality | Excellent with task-specific optimizations | Very good general purpose |
| Speed | Optimized for code generation | Balanced performance |
| Feature Support | MCP, specialized prompts | Standard function calling |
| Error Handling | Enhanced debugging | Standard error messages |

## üîç Monitoring Progress

While AIDE ML runs, you can monitor:

1. **Console Output**: Real-time progress updates
2. **Journal File**: Detailed logs (use `tail -f outputs/.../journal.json`)
3. **Performance Logs**: `~/.aide_ml/performance_logs/`

## üêõ Troubleshooting

### Common Issues

1. **Data Loading Errors**:
   - Ensure the CSV file exists at the correct path
   - Check file permissions

2. **Model Convergence Issues**:
   - Time series models may need parameter tuning
   - Consider increasing iterations

3. **Memory Issues**:
   - Reduce number of workers: `--workers 1`
   - Use simpler models first

4. **API Rate Limits**:
   - Add delays between requests
   - Use fewer parallel workers

### Debug Mode

Enable detailed logging:
```bash
python run_bitcoin.py --backend claude_code --debug
```

## üìö Learning from Results

After running:

1. **Review the solution code** to understand the approach
2. **Check the journal** for AIDE ML's reasoning process
3. **Analyze the tree visualization** to see explored paths
4. **Compare backend outputs** to understand differences

## üöÄ Next Steps

1. **Modify the task**: Edit the task description to guide AIDE ML differently
2. **Add constraints**: Specify particular models or approaches to use
3. **Enhance evaluation**: Add custom metrics beyond RMSE
4. **Combine approaches**: Use hybrid backend for best results

## üìñ Additional Resources

- [Main AIDE ML Documentation](../../README.md)
- [Time Series Forecasting Best Practices](https://otexts.com/fpp3/)
- [Bitcoin Data Sources](https://www.kaggle.com/datasets)

Happy forecasting! üìà